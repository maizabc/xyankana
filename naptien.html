<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>N·∫°p Ti·ªÅn</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .form-section {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>

<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold">N·∫°p Ti·ªÅn</h3>
    <div>
      <a href="index.html" class="btn btn-outline-dark me-2">Trang ch·ªß</a>
      <a href="thong-tin.html" class="btn btn-outline-info me-2">Th√¥ng tin</a>
      <a href="login.html" class="btn btn-outline-primary">ƒêƒÉng nh·∫≠p</a>
      <a href="register.html" class="btn btn-outline-success ms-2">ƒêƒÉng k√Ω</a>
      <a href="naptien.html" class="btn btn-warning ms-2">N·∫°p ti·ªÅn</a>
    </div>
  </div>

  <h4 class="mb-4">N·∫°p ti·ªÅn v√†o t√†i kho·∫£n</h4>

  <!-- CHUY·ªÇN KHO·∫¢N NG√ÇN H√ÄNG -->
  <div class="form-section">
    <h5>üí≥ Chuy·ªÉn kho·∫£n ng√¢n h√†ng</h5>
    <p><strong>Ng√¢n h√†ng:</strong> Techcombank</p>
    <p><strong>S·ªë t√†i kho·∫£n:</strong> <span class="fw-bold">223333336666</span></p>
    <p><strong>Ch·ªß t√†i kho·∫£n:</strong> NGO XUAN BAC</p>
    <p class="text-muted">Sau khi chuy·ªÉn kho·∫£n, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông c·ªông ti·ªÅn n·∫øu b·∫°n ƒë√£ t√≠ch h·ª£p Webhook PayOS.</p>
  </div>

  <!-- N·∫†P TI·ªÄN QUA PAYOS -->
  <div class="form-section">
    <h5>üí∞ N·∫°p ti·ªÅn qua QR Code (PayOS)</h5>
    <div class="mb-3">
      <label for="qrAmount" class="form-label">S·ªë ti·ªÅn c·∫ßn n·∫°p</label>
      <select id="qrAmount" class="form-select">
        <option value="10000">10.000ƒë</option>
        <option value="20000">20.000ƒë</option>
        <option value="50000" selected>50.000ƒë</option>
        <option value="100000">100.000ƒë</option>
      </select>
    </div>
    <button class="btn btn-dark" onclick="payWithPayOS()">N·∫°p qua QR Code</button>
  </div>

  <!-- N·∫†P TH·∫∫ C√ÄO -->
  <div class="form-section">
    <h5>üßæ N·∫°p th·∫ª c√†o ƒëi·ªán tho·∫°i</h5>
    <form onsubmit="submitCard(event)">
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Nh√† m·∫°ng</label>
          <select class="form-select" id="telco">
            <option value="VIETTEL">Viettel</option>
            <option value="MOBI">Mobifone</option>
            <option value="VINA">Vinaphone</option>
          </select>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">M·ªánh gi√°</label>
          <select class="form-select" id="amount">
            <option value="10000">10.000ƒë</option>
            <option value="20000">20.000ƒë</option>
            <option value="50000">50.000ƒë</option>
            <option value="100000">100.000ƒë</option>
          </select>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">M√£ th·∫ª</label>
          <input type="text" id="code" class="form-control" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">S·ªë Seri</label>
          <input type="text" id="serial" class="form-control" required>
        </div>
      </div>
      <button type="submit" class="btn btn-success">G·ª≠i th·∫ª</button>
    </form>
    <div class="mt-3" id="cardResult"></div>
  </div>
</div>

<script>
  // G·ªçi API t·∫°o QR PayOS
  async function payWithPayOS() {
    const amount = parseInt(document.getElementById("qrAmount").value);
    const orderCode = Date.now();

    const CLIENT_ID = "YOUR_CLIENT_ID_HERE";
    const API_KEY   = "YOUR_API_KEY_HERE";

    const returnUrl = `https://yourdomain.com/index.html?success=1&amount=${amount}`;
    const cancelUrl = `https://yourdomain.com/index.html?success=0`;

    try {
      const response = await fetch("https://api-merchant.payos.vn/v2/payment-requests", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-client-id": CLIENT_ID,
          "x-api-key": API_KEY
        },
        body: JSON.stringify({
          orderCode,
          amount,
          description: `N·∫°p ti·ªÅn ${amount.toLocaleString()}ƒë qua PayOS`,
          returnUrl,
          cancelUrl,
          items: [{
            name: "N·∫°p v√†o t√†i kho·∫£n",
            quantity: 1,
            price: amount
          }]
        })
      });

      const data = await response.json();
      if (data.checkoutUrl) {
        window.open(data.checkoutUrl, "_blank");
      } else {
        alert("‚ùå Kh√¥ng th·ªÉ t·∫°o thanh to√°n QR.");
        console.error(data);
      }
    } catch (error) {
      alert("‚ùå L·ªói khi k·∫øt n·ªëi t·ªõi PayOS.");
      console.error(error);
    }
  }

  // X·ª≠ l√Ω n·∫°p th·∫ª c√†o
  function submitCard(event) {
    event.preventDefault();

    const amount = parseInt(document.getElementById("amount").value);
    const code = document.getElementById("code").value.trim();
    const serial = document.getElementById("serial").value.trim();
    let balance = parseInt(localStorage.getItem("balance") || "0");

    const resultBox = document.getElementById("cardResult");

    if (!code || !serial) {
      resultBox.innerHTML = `<div class="alert alert-danger">‚ö†Ô∏è Vui l√≤ng nh·∫≠p m√£ th·∫ª v√† s·ªë seri!</div>`;
      return;
    }

    resultBox.innerHTML = "<span class='text-info'>‚è≥ ƒêang x·ª≠ l√Ω...</span>";

    setTimeout(() => {
      balance += amount;
      localStorage.setItem("balance", balance);
      resultBox.innerHTML = `
        <div class="alert alert-success">
          ‚úÖ N·∫°p th·∫ª th√†nh c√¥ng <strong>${amount.toLocaleString()}ƒë</strong><br>
          <strong>S·ªë d∆∞ m·ªõi:</strong> ${balance.toLocaleString()}ƒë
          <div class="mt-3">
            <a href="index.html" class="btn btn-outline-success btn-sm">üîô V·ªÅ Trang Ch·ªß</a>
            <a href="thong-tin.html" class="btn btn-outline-primary btn-sm ms-2">üìÇ Xem t√†i kho·∫£n</a>
          </div>
        </div>
      `;
      document.getElementById("code").value = "";
      document.getElementById("serial").value = "";
    }, 1000);
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
